{% load static %}
<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width initial-scale=1.0" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">

    <meta content="Theodosis Tsaklanos - 8170136" name="author">
    <meta content="Paris Mpampaniotis - 8170080" name="author">

    <title>EnterPrice - My Products</title>
    <link rel="icon" href="{% static "home/icons/logo-lg.png" %}" type="image/x-icon">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{% static "css/navbar-theme.css" %}">
    <link rel="stylesheet" href="{% static "css/core-theme.css" %}">
    <link rel="stylesheet" href="{% static "store_review/css/timeline-theme.css" %}">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<style>

    .review-button {
        margin: 0 30px;
    }

    @media screen and (max-width:992px) {
        hr {
            margin: 2px 0;
        }
	}

	@media screen and (max-width:1200px) {
        .review-button {
            margin: 2px 10px;
        }
	}


</style>

<body>
{% include 'navbar.html' %}
<div class="container-fluid" style="margin-top: 30px;">
    {% if purchases|length > 0 %}
        <div class="col-xs-12 col-md-2" style="margin-top: 45px">
            <h4>Purchase Timeline</h4>
            <button class="btn btn-round enterprice-blue visible-xs visible-sm" data-target="#timeline_bar"
                    data-toggle="collapse"><i aria-hidden="true" class="fa fa-history fa-2x"></i></button>
            <div class="hidden-xs hidden-sm" id="timeline_bar">
                <ul class="timeline">
                    {% for purchase in purchases %}
                    <li>
                        <a href="#{{purchase.purchase_id}}">{{purchase.purchase_date}}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-xs-12 col-md-10">
            {% for purchase in purchases %}
            <div class="text-center" id="{{purchase.purchase_id}}">
                <h3 style="color:#282828">{{purchase.purchase_date}}</h3>
            </div>
            <hr>

            <div class="row" style="margin:30px 0">
                <div class="row review-button">
                    <form method="post" action="{% url 'write-review' purchase.purchase_id %}">
                        {% csrf_token %}
                        <div class="col-sm-6 col-sm-offset-6 col-md-4 col-md-offset-8 col-lg-3 col-lg-offset-9">
                            {% if purchase in purchases_that_have_been_reviewed %}
                                <button type="submit" class="btn btn-block enterprice-blue btn-round">
                                        <span>Edit Review</span>
                                </button>
                            {% else %}
                                <button type="submit" class="btn btn-block enterprice-blue btn-round">
                                        <span>Review Store</span>
                                </button>
                            {% endif %}
                        </div>
                    </form>

                </div>

                {% for line_item in purchase.lineItems.all %}
                <div class="col-xs-12 col-md-6 col-lg-4">
                    <div class="thumbnail">
                        <div class="caption text-center">
                            <div class="position-relative">
                                <img class="img-size-md" src="{% static line_item.product.product_img %}"/>
                            </div>
                            <h4 id="thumbnail-label">{{line_item.product.product_name}}</h4>
                            <p><i class="glyphicon glyphicon-list light-red lighter bigger-120"></i>
                                {{line_item.product.category}}</p>
                            <div class="thumbnail-description">
                                <ul class="list-group">
                                    <li class="list-group-item" style="padding: 0px;">
                                        <h4>
                                            <span class="label label-info">{{line_item.price}} &euro;</span>
                                        </h4>
                                    </li>
                                    <li class="list-group-item">Quantity: {{line_item.quantity}}</li>
                                    <li class="list-group-item">Store: {{purchase.store.store_name|escape}}</li>
                                </ul>
                            </div>
                            <div class="caption card-footer text-center">
                                <ul class="list-inline text-center">
                                    <li>&nbsp; <i class="glyphicon glyphicon-info-sign lighter"></i> Purchase ID:
                                        {{purchase.purchase_id}}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="thumbnail col-xs-8 col-xs-offset-2 col-md-4 col-md-offset-4" style="margin-top:45px">
            <div class="row">
                <div class="col-sm-12">
                    <div class="text-center">
                        <img src="{% static "home/icons/sad-face.png" %}"/>
                        <div class="alert text-center"
                            style="margin-top:3px; font-size:16px; background-color:aliceblue"
                             role="alert">
                            <h3>There are no purchases yet!</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% include 'footer.html' %}
</body>
</html>